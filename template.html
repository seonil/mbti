<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MBTI 심심풀이 땅콩앱 - 회사생활 생존 시뮬레이터</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background:
        radial-gradient(120% 140% at 0% 0%, rgba(59, 130, 246, 0.28) 0%, rgba(2, 6, 23, 0) 50%),
        radial-gradient(120% 140% at 100% 0%, rgba(236, 72, 153, 0.24) 0%, rgba(2, 6, 23, 0) 50%),
        radial-gradient(120% 140% at 50% 100%, rgba(16, 185, 129, 0.18) 0%, rgba(2, 6, 23, 0.3) 55%),
        #020617;
      color: #E2E8F0;
      min-height: 100vh;
    }
    .mbti-btn {
      transform: translateZ(0);
    }
    .mbti-btn:hover {
      transform: translateY(-4px) scale(1.01);
      box-shadow: 0 20px 35px rgba(15, 23, 42, 0.35);
    }
    .mbti-btn.selected {
      box-shadow: 0 25px 45px rgba(15, 23, 42, 0.45);
    }
    .glow-card {
      position: relative;
    }
    .glow-card::before {
      content: ";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(148, 163, 184, 0.65), rgba(79, 70, 229, 0.4));
      opacity: 0.45;
      filter: blur(22px);
      z-index: -1;
    }
    .quiz-stack {
      position: relative;
      width: min(100%, 520px);
      min-height: 390px;
    }
    .quiz-card {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateY(32px) scale(0.94);
      transition: transform 0.6s ease, opacity 0.6s ease;
      pointer-events: none;
    }
    .quiz-card.active {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .quiz-card.completed {
      opacity: 0;
      transform: translateY(-48px) scale(0.85);
    }
    .quiz-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.8s ease;
    }
    .quiz-card-inner.flipped {
      transform: rotateY(180deg);
    }
    .quiz-card-face {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 18px;
      padding: 32px 28px;
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(18px);
      box-shadow: 0 25px 60px rgba(2, 6, 23, 0.35);
      backface-visibility: hidden;
    }
    .quiz-card-back {
      transform: rotateY(180deg);
      text-align: center;
      align-items: center;
      justify-content: center;
    }
    .quiz-round {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0.45rem 0.95rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(148, 163, 184, 0.12);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #cbd5f5;
    }
    .quiz-hint {
      margin-top: 1.2rem;
      font-size: 0.85rem;
      color: #94A3B8;
      background: rgba(148, 163, 184, 0.12);
      border-radius: 16px;
      padding: 0.85rem 1rem;
      line-height: 1.6;
    }
    .quiz-option {
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      color: #E2E8F0;
      font-weight: 600;
      text-align: left;
      padding: 14px 18px;
      transition: all 0.2s ease;
    }
    .quiz-option:hover {
      border-color: var(--quiz-accent, rgba(148, 163, 184, 0.45));
      background: rgba(15, 118, 110, 0.18);
      transform: translateY(-2px);
    }
    .quiz-option:disabled {
      cursor: not-allowed;
    }
    .quiz-option-correct {
      border-color: rgba(34, 197, 94, 0.65) !important;
      background: rgba(34, 197, 94, 0.2) !important;
      color: #bbf7d0 !important;
    }
    .quiz-option-wrong {
      border-color: rgba(248, 113, 113, 0.6) !important;
      background: rgba(248, 113, 113, 0.18) !important;
      color: #fecaca !important;
    }
    .quiz-option-disabled {
      opacity: 0.5;
    }
    .result-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 1.4rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.72rem;
      letter-spacing: 0.35em;
      text-transform: uppercase;
    }
    .result-success {
      border-color: rgba(34, 197, 94, 0.45);
      background: rgba(34, 197, 94, 0.14);
      color: #bbf7d0;
    }
    .result-fail {
      border-color: rgba(248, 113, 113, 0.4);
      background: rgba(248, 113, 113, 0.14);
      color: #fecaca;
    }
    .quiz-stat-card {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 130px;
      padding: 14px 18px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(12px);
    }
    .quiz-stat-label {
      font-size: 0.68rem;
      font-weight: 600;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #94A3B8;
    }
    .quiz-stat-value {
      display: flex;
      align-items: baseline;
      gap: 6px;
      color: #E2E8F0;
      font-weight: 700;
    }
    .quiz-stat-total {
      font-size: 0.8rem;
      color: #64748B;
    }
    .quiz-summary.hidden {
      display: none;
    }
    .quiz-restart {
      margin-top: 1.6rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.65rem 1.6rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: transparent;
      color: #E2E8F0;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      transition: all 0.2s ease;
    }
    .quiz-restart:hover {
      border-color: rgba(148, 163, 184, 0.65);
      background: rgba(148, 163, 184, 0.18);
    }
    @media (max-width: 640px) {
      .quiz-card-face {
        padding: 24px 20px;
        gap: 16px;
      }
      .quiz-stack {
        min-height: 340px;
      }
      .quiz-stat-card {
        min-width: 110px;
      }
    }

  
    .quiz-stack {
      position: relative;
      width: min(100%, 520px);
      min-height: 390px;
    }
    .quiz-card {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateY(32px) scale(0.94);
      transition: transform 0.6s ease, opacity 0.6s ease;
      pointer-events: none;
    }
    .quiz-card.active {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .quiz-card.completed {
      opacity: 0;
      transform: translateY(-48px) scale(0.85);
    }
    .quiz-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.8s ease;
    }
    .quiz-card-inner.flipped {
      transform: rotateY(180deg);
    }
    .quiz-card-face {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 18px;
      padding: 32px 28px;
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(18px);
      box-shadow: 0 25px 60px rgba(2, 6, 23, 0.35);
      backface-visibility: hidden;
    }
    .quiz-card-back {
      transform: rotateY(180deg);
      text-align: center;
      align-items: center;
      justify-content: center;
    }
    .quiz-round {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0.45rem 0.95rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(148, 163, 184, 0.12);
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #cbd5f5;
    }
    .quiz-hint {
      margin-top: 1.2rem;
      font-size: 0.85rem;
      color: #94A3B8;
      background: rgba(148, 163, 184, 0.12);
      border-radius: 16px;
      padding: 0.85rem 1rem;
      line-height: 1.6;
    }
    .quiz-option {
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      color: #E2E8F0;
      font-weight: 600;
      text-align: left;
      padding: 14px 18px;
      transition: all 0.2s ease;
    }
    .quiz-option:hover {
      border-color: var(--quiz-accent, rgba(148, 163, 184, 0.45));
      background: rgba(15, 118, 110, 0.18);
      transform: translateY(-2px);
    }
    .quiz-option:disabled {
      cursor: not-allowed;
    }
    .quiz-option-correct {
      border-color: rgba(34, 197, 94, 0.65) !important;
      background: rgba(34, 197, 94, 0.2) !important;
      color: #bbf7d0 !important;
    }
    .quiz-option-wrong {
      border-color: rgba(248, 113, 113, 0.6) !important;
      background: rgba(248, 113, 113, 0.18) !important;
      color: #fecaca !important;
    }
    .quiz-option-disabled {
      opacity: 0.5;
    }
    .result-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 1.4rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.72rem;
      letter-spacing: 0.35em;
      text-transform: uppercase;
    }
    .result-success {
      border-color: rgba(34, 197, 94, 0.45);
      background: rgba(34, 197, 94, 0.14);
      color: #bbf7d0;
    }
    .result-fail {
      border-color: rgba(248, 113, 113, 0.4);
      background: rgba(248, 113, 113, 0.14);
      color: #fecaca;
    }
    .quiz-stat-card {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 130px;
      padding: 14px 18px;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(12px);
    }
    .quiz-stat-label {
      font-size: 0.68rem;
      font-weight: 600;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #94A3B8;
    }
    .quiz-stat-value {
      display: flex;
      align-items: baseline;
      gap: 6px;
      color: #E2E8F0;
      font-weight: 700;
    }
    .quiz-stat-total {
      font-size: 0.8rem;
      color: #64748B;
    }
    .quiz-summary.hidden {
      display: none;
    }
    .quiz-restart {
      margin-top: 1.6rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.65rem 1.6rem;
      border-radius: 9999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: transparent;
      color: #E2E8F0;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      transition: all 0.2s ease;
    }
    .quiz-restart:hover {
      border-color: rgba(148, 163, 184, 0.65);
      background: rgba(148, 163, 184, 0.18);
    }
    @media (max-width: 640px) {
      .quiz-card-face {
        padding: 24px 20px;
        gap: 16px;
      }
      .quiz-stack {
        min-height: 340px;
      }
      .quiz-stat-card {
        min-width: 110px;
      }
    }
  </style>
</head>
<body>
  <div class="relative">
    <main class="mx-auto max-w-7xl px-4 pb-24 pt-16 md:px-8 lg:px-12">
      <header class="mb-16">
        <div class="mx-auto max-w-4xl text-center md:text-left">
          <span class="inline-flex items-center rounded-full border border-white/10 bg-white/10 px-4 py-1 text-xs font-semibold uppercase tracking-[0.45em] text-slate-300">Survival Simulator</span>
          <h1 class="mt-6 text-4xl font-black leading-tight text-slate-100 md:text-6xl">MBTI 심심풀이 땅콩앱 : 회사생활 생존 시뮬레이터</h1>
          <p class="mt-6 text-lg text-slate-300 md:text-xl">당신의 MBTI는 회사에서 어떤 생존 전략을 펼칠까요? 16가지 유형과의 대결 미션을 수행하며 적응도를 업그레이드하세요.</p>
          <div class="mt-8 grid gap-4 sm:grid-cols-3">
            <div class="glow-card rounded-2xl border border-white/10 bg-white/5 p-5 text-left shadow-xl backdrop-blur">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">오늘의 목표</p>
              <p class="mt-3 text-base font-semibold text-slate-100">16개 미션에서 살아남아 올킬 달성</p>
            </div>
            <div class="glow-card rounded-2xl border border-white/10 bg-white/5 p-5 text-left shadow-xl backdrop-blur">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">필수 장비</p>
              <p class="mt-3 text-base font-semibold text-slate-100">유형별 생존 데이터 & 맞춤형 필살 멘트</p>
            </div>
            <div class="glow-card rounded-2xl border border-white/10 bg-white/5 p-5 text-left shadow-xl backdrop-blur">
              <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">재미 요소</p>
              <p class="mt-3 text-base font-semibold text-slate-100">사내 대결 스토리텔링으로 지루함 0%</p>
            </div>
          </div>
        </div>
      </header>

      <section class="mb-14">
        <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
          <div>
            <h2 class="text-3xl font-bold text-slate-100">MBTI 타입 선택</h2>
            <p class="mt-2 text-sm text-slate-400">대결할 유형을 선택하면 생존 매뉴얼이 즉시 펼쳐집니다.</p>
          </div>
          <p class="text-xs uppercase tracking-[0.35em] text-slate-500">choose · analyze · survive</p>
        </div>
        <div id="mbtiSelector" class="mt-6 grid grid-cols-2 gap-3 sm:grid-cols-4 lg:grid-cols-8"></div>
      </section>

      <section id="resultsArea">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-12 text-center shadow-2xl backdrop-blur">
          <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">select mbti</p>
          <p class="mt-4 text-lg text-slate-200">유형을 선택하면 맞춤형 회사생활 생존 전략이 나타납니다.</p>
        </div>
      </section>

      <section class="mt-20">
        <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
          <h2 class="text-3xl font-bold text-slate-100">생존 조합 리포트</h2>
          <p class="text-sm text-slate-400">팀 빌딩이나 프로젝트 스쿼드 구성에 참고하세요.</p>
        </div>
        <div class="mt-8 grid gap-6 md:grid-cols-2">
          <div class="rounded-3xl border border-emerald-500/20 bg-emerald-500/10 p-6 shadow-lg backdrop-blur">
            <h3 class="text-lg font-semibold text-emerald-200">최고의 파티</h3>
            <ul class="mt-4 space-y-4 text-sm text-slate-100">
              <li>
                <p class="font-bold text-slate-100">ENTJ · INTJ · ENFJ · ISTJ</p>
                <p class="mt-1 text-slate-200">비전·전략·조율·시스템이 빈틈없이 맞물리는 철벽 메가톤 조합.</p>
              </li>
              <li>
                <p class="font-bold text-slate-100">ESTJ · INTP · ESFJ · ISTP</p>
                <p class="mt-1 text-slate-200">현실 실행력과 분석, 관계 케어, 현장 대응이 시너지를 낸다.</p>
              </li>
              <li>
                <p class="font-bold text-slate-100">ENFP · INFJ · ISFP · ESTP</p>
                <p class="mt-1 text-slate-200">영감·통찰·감성·액션이 폭발하는 하이브리드 크루.</p>
              </li>
            </ul>
          </div>
          <div class="rounded-3xl border border-rose-500/20 bg-rose-500/10 p-6 shadow-lg backdrop-blur">
            <h3 class="text-lg font-semibold text-rose-200">난이도 높은 파티</h3>
            <ul class="mt-4 space-y-4 text-sm text-slate-100">
              <li>
                <p class="font-bold text-slate-100">INFP · ENFP · INTP · ISFP</p>
                <p class="mt-1 text-slate-200">결정이 미뤄지고 감정 에너지가 고갈되기 쉬운 조합. 진행자가 필수!</p>
              </li>
              <li>
                <p class="font-bold text-slate-100">ENTP · ENTP · ENFP · ESTP</p>
                <p class="mt-1 text-slate-200">아이디어 폭주로 실행 담당자가 지칠 수 있음. 마감 수호신을 세우세요.</p>
              </li>
              <li>
                <p class="font-bold text-slate-100">ISTJ · ESTJ · INTJ · ISTP</p>
                <p class="mt-1 text-slate-200">현실 검증이 끝없이 이어져 회의실이 얼음장 될 수 있음. 감정 온도 조절 필요.</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="mt-6 rounded-3xl border border-white/10 bg-gradient-to-r from-white/10 via-transparent to-white/10 p-6 text-sm text-slate-300">
          <strong class="text-slate-100">주의:</strong> 조합은 힌트일 뿐입니다. 팀의 현재 상황과 목표에 맞게 유연하게 적용하세요.
        </div>
      </section>

      <section class="mt-16">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-8 shadow-xl backdrop-blur">
          <div class="grid gap-8 md:grid-cols-4">
            <div class="md:col-span-3">
              <h2 class="text-3xl font-bold text-slate-100">게임 가이드</h2>
              <div class="mt-6 grid gap-6 md:grid-cols-3">
                <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
                  <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">1. Type Scan</p>
                  <h3 class="mt-3 text-lg font-semibold text-slate-100">유형 스캔</h3>
                  <p class="mt-2 text-sm text-slate-300">버튼을 눌러 유형을 선택하면 생존 데이터와 미션이 실시간으로 업데이트됩니다.</p>
                </div>
                <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
                  <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">2. Battle Prep</p>
                  <h3 class="mt-3 text-lg font-semibold text-slate-100">전략 준비</h3>
                  <p class="mt-2 text-sm text-slate-300">강점·위기 포인트와 파워 아이템을 활용해 회의 안건, 메시지, 협업 룰을 세팅하세요.</p>
                </div>
                <div class="rounded-2xl border border-white/10 bg-slate-900/60 p-5">
                  <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">3. Mission Clear</p>
                  <h3 class="mt-3 text-lg font-semibold text-slate-100">미션 클리어</h3>
                  <p class="mt-2 text-sm text-slate-300">대결 전략의 3단계를 따라가고 피니시 무브로 마무리하면 생존 성공!</p>
                </div>
              </div>
            </div>
            <div class="rounded-2xl border border-white/10 bg-gradient-to-b from-white/10 to-white/5 p-5 text-sm text-slate-300">
              <h3 class="text-base font-semibold text-slate-100">Bonus Tip</h3>
              <p class="mt-3">URL 끝에 <code class="rounded bg-slate-900 px-1.5 py-0.5 text-xs text-sky-300">?type=ENTP</code>처럼 붙이면 원하는 카드로 바로 공유할 수 있어요.</p>
              <p class="mt-4">GitHub Pages에 업로드하면 동료들이 언제든 이 생존 매뉴얼을 펼칠 수 있습니다.</p>
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class="border-t border-white/10 px-4 py-10 text-center text-xs text-slate-500">
      ⓒ 2025 VibeCoding MBTI Lab. GitHub Pages Ready.
    </footer>
  </div>

  <script>
    const MBTI_DATA = __MBTI_DATA__;
    const MBTI_SEQUENCE = __MBTI_SEQUENCE__;
    const selectorEl = document.getElementById("mbtiSelector");
    const resultsEl = document.getElementById("resultsArea");
    const buttonMap = {};

    prepareQuizData();

    MBTI_SEQUENCE.forEach((type) => {
      if (!MBTI_DATA[type]) {
        return;
      }
      const btn = document.createElement("button");
      btn.type = "button";
      btn.textContent = type;
      btn.className = "mbti-btn relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm font-semibold uppercase tracking-[0.4em] text-slate-200 shadow-lg transition duration-200 ease-out backdrop-blur";
      btn.addEventListener("click", () => setActiveType(type));
      selectorEl.appendChild(btn);
      buttonMap[type] = btn;
      resetButtonAppearance(btn);
    });

    function resetButtonAppearance(btn) {
      btn.classList.remove("selected");
      btn.style.background = "rgba(255, 255, 255, 0.06)";
      btn.style.color = "#E2E8F0";
      btn.style.borderColor = "rgba(148, 163, 184, 0.25)";
      btn.style.boxShadow = "0 16px 32px rgba(15, 23, 42, 0.28)";
    }

    function setActiveType(type, skipScroll) {
      const data = MBTI_DATA[type];
      if (!data) {
        return;
      }

      Object.values(buttonMap).forEach((btn) => resetButtonAppearance(btn));

      const currentBtn = buttonMap[type];
      currentBtn.classList.add("selected");
      currentBtn.style.background = data.theme.accentSoft;
      currentBtn.style.color = data.theme.accentText;
      currentBtn.style.borderColor = data.theme.accent;
      currentBtn.style.boxShadow = "0 22px 45px " + hexToRgba(data.theme.accent, 0.35);

      renderProfile(type);

      const url = new URL(window.location);
      url.searchParams.set("type", type);
      window.history.replaceState({}, "", url);

      if (!skipScroll) {
        resultsEl.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function hexToRgba(hex, alpha) {
      let value = hex.replace("#", "");
      if (value.length === 3) {
        value = value.split("").map((ch) => ch + ch).join("");
      }
      const intValue = parseInt(value, 16);
      const r = (intValue >> 16) & 255;
      const g = (intValue >> 8) & 255;
      const b = intValue & 255;
      return "rgba(" + r + ", " + g + ", " + b + ", " + alpha + ")";
    }

    function renderProfile(type) {
      const data = MBTI_DATA[type];
      if (!data) {
        return;
      }

      const accent = data.theme.accent;
      const accentSoft = data.theme.accentSoft;
      const accentText = data.theme.accentText;
      const headerGradient = data.theme.headerGradient;
      const headerText = data.theme.headerText;

      const metricsHTML = data.metrics.map((metric) => `
        <div class="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-sm">
          <div class="flex items-center justify-between">
            <span class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">${metric.label}</span>
            <span class="text-xl font-bold text-slate-100">${metric.value}</span>
          </div>
          <div class="mt-3 h-2.5 rounded-full bg-slate-800 shadow-inner">
            <div class="h-full rounded-full" style="background:${accent}; width:${metric.value}%;"></div>
          </div>
          <p class="mt-3 text-sm text-slate-300">${metric.description}</p>
        </div>
      `).join("");

      const strengthsHTML = data.strengths.map((item) => `
        <li class="flex items-start gap-3 rounded-2xl border border-white/10 bg-white/5 p-4">
          <span class="mt-1 inline-flex h-2.5 w-2.5 flex-none rounded-full" style="background:${accent};"></span>
          <p class="text-sm text-slate-200">${item}</p>
        </li>
      `).join("");

      const warningsHTML = data.warnings.map((item) => `
        <li class="flex items-start gap-3 rounded-2xl border border-rose-400/30 bg-rose-400/10 p-4">
          <span class="mt-1 inline-flex h-2.5 w-2.5 flex-none rounded-full bg-rose-400"></span>
          <p class="text-sm text-rose-100">${item}</p>
        </li>
      `).join("");

      const movesHTML = data.battle.moves.map((move, idx) => `
        <div class="flex gap-4 rounded-2xl border border-white/10 bg-white/5 p-4">
          <div class="flex h-10 w-10 flex-none items-center justify-center rounded-full font-semibold" style="background:${accentSoft}; color:${accentText};">${idx + 1}</div>
          <div>
            <h4 class="text-base font-semibold text-slate-100">${move.name}</h4>
            <p class="mt-2 text-sm text-slate-300">${move.detail}</p>
          </div>
        </div>
      `).join("");

      const quickPhrasesHTML = data.quickPhrases.map((phrase) => `
        <li class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3 text-sm text-slate-200">? ${phrase}</li>
      `).join("");

      resultsEl.innerHTML = `
        <div class="overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-2xl">
          <div class="relative p-8 md:p-10" style="background:${headerGradient}; color:${headerText};">
            <div class="flex flex-wrap items-center gap-4">
              <span class="inline-flex items-center rounded-full bg-white/15 px-4 py-1 text-xs font-semibold uppercase tracking-[0.4em]">Battle Card</span>
              <span class="text-sm opacity-80">${data.summary}</span>
            </div>
            <h2 class="mt-6 text-4xl font-extrabold md:text-5xl">${type} · ${data.nickname}</h2>
            <p class="mt-4 max-w-3xl text-base md:text-lg">${data.battle.title}</p>
          </div>
          <div class="grid gap-10 bg-slate-950/40 p-8 md:p-12">
            <div class="grid gap-6 lg:grid-cols-3">
              ${metricsHTML}
            </div>

            <div class="grid gap-6 lg:grid-cols-3">
              <div class="lg:col-span-2">
                <h3 class="text-lg font-bold text-slate-100">생존을 돕는 핵심 장점</h3>
                <ul class="mt-4 grid gap-3 md:grid-cols-2">
                  ${strengthsHTML}
                </ul>
              </div>
              <div>
                <h3 class="text-lg font-bold text-rose-200">주의해야 할 위기 포인트</h3>
                <ul class="mt-4 grid gap-3">
                  ${warningsHTML}
                </ul>
              </div>
            </div>

            <div class="grid gap-6 lg:grid-cols-[1.25fr_0.75fr]">
              <div>
                <h3 class="text-lg font-bold text-slate-100">대결 생존 전략</h3>
                <p class="mt-2 text-sm text-slate-300">${data.battle.intro}</p>
                <div class="mt-6 grid gap-4">
                  ${movesHTML}
                </div>
                <div class="mt-6 rounded-2xl border border-white/10 bg-white/5 p-5 text-sm text-slate-200">
                  <strong class="block text-slate-100">피니시 무브</strong>
                  <span class="mt-2 block text-slate-300">${data.battle.finale}</span>
                </div>
              </div>
              <div class="grid gap-4">
                <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
                  <h3 class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-400">파워 아이템</h3>
                  <dl class="mt-4 space-y-3 text-sm text-slate-200">
                    <div>
                      <dt class="font-semibold text-slate-100">최고의 아군</dt>
                      <dd class="text-slate-300">${data.powerItems.ally}</dd>
                    </div>
                    <div>
                      <dt class="font-semibold text-slate-100">주의할 약점</dt>
                      <dd class="text-slate-300">${data.powerItems.weakSpot}</dd>
                    </div>
                    <div>
                      <dt class="font-semibold text-slate-100">필수 지원 장비</dt>
                      <dd class="text-slate-300">${data.powerItems.support}</dd>
                    </div>
                  </dl>
                </div>
                <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
                  <h3 class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-400">필살 멘트</h3>
                  <ul class="mt-3 space-y-2">
                    ${quickPhrasesHTML}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      renderQuiz(type, data);
    }


    function prepareQuizData() {
      const fallbackPhrases = [
        '일단 대충 하자는 말은 통하지 않아요.',
        '감정선을 무시하면 바로 신뢰가 떨어집니다.',
        '보고 생략 제안은 위험합니다.',
        '혼자 결정하고 통보하면 관계가 금 가요.',
        '기록을 건너뛰면 다음 라운드가 무너집니다.',
        '느낌대로 하기 전에 근거가 필요해요.',
        '대충 넘어가자는 말은 최악의 선택입니다.',
        '후폭풍을 무시하면 곤란해집니다.',
        '계획 생략 제안은 거절당합니다.',
        '감정 케어 없이 밀어붙이면 관계가 멀어져요.'
      ];
      let cursor = 0;
      Object.values(MBTI_DATA).forEach((info) => {
        if (info.quiz && Array.isArray(info.quiz.cards)) {
          return;
        }
        const moves = Array.isArray(info.battle?.moves) ? info.battle.moves : [];
        const power = info.powerItems || {};
        const quick = Array.isArray(info.quickPhrases) ? info.quickPhrases : [];
        const move1 = moves[0] || { name: '선제 행동', detail: info.battle?.title || '' };
        const move2 = moves[1] || moves[0] || { name: '타이밍 조율', detail: info.battle?.intro || '' };
        const move3 = moves[2] || moves[1] || moves[0] || { name: '마무리 협상', detail: info.battle?.finale || '' };
        const support = power.support || '기록 가능한 지원 장비';
        const ally = power.ally || '믿을 만한 동료';
        const weakSpot = power.weakSpot || '숨은 약점';
        const phrase = quick[0] || info.battle?.finale || '다음 라운드를 위한 약속을 잡아요.';
        const wrong1 = fallbackPhrases[cursor % fallbackPhrases.length];
        const wrong2 = fallbackPhrases[(cursor + 1) % fallbackPhrases.length];
        cursor += 2;

        info.quiz = {
          cards: [
            {
              round: 'ROUND 1',
              title: '전략 오프닝',
              prompt: `${info.nickname}과(와)의 첫 라운드! 어떤 액션으로 시작할까?`,
              hint: info.battle?.intro || '',
              options: [
                { label: move1.name, isCorrect: true, feedback: move1.detail },
                { label: move2.name, isCorrect: false, feedback: `${move2.detail} — 타이밍을 조금 늦춰보자.` },
                { label: move3.name, isCorrect: false, feedback: `${move3.detail} — 마무리 단계에 어울립니다.` }
              ],
              success: '완벽한 스타트!',
              failure: '시작부터 삐끗했어요. 타이밍을 다시 조율해요.'
            },
            {
              round: 'ROUND 2',
              title: '파워 아이템 세팅',
              prompt: `${info.nickname}에게 가장 필요한 지원 장비는?`,
              hint: `약점을 보완할 장비를 골라야 합니다. ${weakSpot}을(를) 커버하세요.`,
              options: [
                { label: support, isCorrect: true, feedback: `${support}이(가) 있어야 ${info.nickname}의 강점이 폭발해요.` },
                { label: ally, isCorrect: false, feedback: `${ally}은(는) 최고의 동료지만 장비는 아니에요.` },
                { label: weakSpot, isCorrect: false, feedback: `${weakSpot}은(는) 관리해야 할 약점이에요.` }
              ],
              success: '장비 세팅 완료!',
              failure: '장비 선택을 다시 생각해봐요.'
            },
            {
              round: 'ROUND 3',
              title: '클로징 멘트',
              prompt: `${info.nickname}에게 마지막으로 건넬 멘트는?`,
              hint: '감정선과 전략을 동시에 잡을 수 있는 말을 고르세요.',
              options: [
                { label: phrase, isCorrect: true, feedback: '이 멘트가 바로 신뢰를 높이는 한마디예요.' },
                { label: wrong1, isCorrect: false, feedback: '이 멘트는 분위기를 깨고 신뢰를 떨어뜨립니다.' },
                { label: wrong2, isCorrect: false, feedback: '상대에게 부담만 주는 멘트입니다.' }
              ],
              success: '완벽한 마무리!',
              failure: `${info.nickname}의 감정선과 맞지 않는 마무리였어요.`
            }
          ],
          summary: {
            title: `${info.nickname} 생존 시뮬레이션 결과`,
            winMessage: info.battle?.finale || '완벽한 마무리! 함께 다음 스테이지로 전진합니다.',
            loseMessage: `${info.nickname}과(와)의 동맹을 위해 전략을 다시 세워보세요.`
          }
        };
      });
    }

    function renderQuiz(type, data) {
      if (!data.quiz || !Array.isArray(data.quiz.cards) || data.quiz.cards.length === 0) {
        return;
      }

      const existing = resultsEl.querySelector(`[data-quiz-root='${type}']`);
      if (existing) {
        existing.remove();
      }

      const section = document.createElement('section');
      section.className = 'mt-16';
      section.dataset.quizRoot = type;
      section.style.setProperty('--quiz-accent', data.theme.accent);
      section.style.setProperty('--quiz-accent-text', data.theme.accentText);
      section.innerHTML = `
        <div class='flex flex-col gap-4 md:flex-row md:items-end md:justify-between'>
          <div>
            <h3 class='text-3xl font-bold text-slate-100'>대결 시뮬레이션</h3>
            <p class='mt-2 text-sm text-slate-300'>세 장의 카드를 뒤집으며 ${type} 미션을 클리어하세요.</p>
          </div>
          <div class='flex gap-3'>
            <div class='quiz-stat-card'>
              <span class='quiz-stat-label'>Score</span>
              <div class='quiz-stat-value'>
                <span data-role='score'>0</span>
                <span class='quiz-stat-total'>/${data.quiz.cards.length}</span>
              </div>
            </div>
            <div class='quiz-stat-card'>
              <span class='quiz-stat-label'>Round</span>
              <div class='quiz-stat-value'>
                <span data-role='progress'>1</span>
                <span class='quiz-stat-total'>/${data.quiz.cards.length}</span>
              </div>
            </div>
          </div>
        </div>
        <div class='mt-4 rounded-2xl border border-white/10 bg-white/5 p-4 text-sm text-slate-300'>${data.battle?.intro || ''}</div>
        <div class='relative mt-8 flex justify-center'>
          <div class='quiz-stack' data-role='card-stack'></div>
        </div>
        <div class='quiz-summary hidden mt-10 mx-auto max-w-2xl rounded-3xl border border-white/10 bg-white/5 p-8 text-center' data-role='summary'>
          <h4 class='text-2xl font-bold text-slate-100' data-role='summary-title'></h4>
          <p class='mt-4 text-sm text-slate-300' data-role='summary-message'></p>
          <p class='mt-2 text-xs uppercase tracking-[0.35em] text-slate-500' data-role='summary-note'></p>
          <button type='button' class='quiz-restart hidden' data-role='restart'>다시 도전하기</button>
        </div>
      `;

      resultsEl.appendChild(section);
      initQuizDeck(section, data.quiz, type);
    }

    function initQuizDeck(section, quiz, type) {
      const stackEl = section.querySelector('[data-role="card-stack"]');
      const scoreEl = section.querySelector('[data-role="score"]');
      const progressEl = section.querySelector('[data-role="progress"]');
      const summaryEl = section.querySelector('[data-role="summary"]');
      const summaryTitleEl = summaryEl.querySelector('[data-role="summary-title"]');
      const summaryMessageEl = summaryEl.querySelector('[data-role="summary-message"]');
      const summaryNoteEl = summaryEl.querySelector('[data-role="summary-note"]');
      const restartBtn = summaryEl.querySelector('[data-role="restart"]');

      stackEl.innerHTML = '';
      summaryEl.classList.add('hidden');
      summaryTitleEl.textContent = '';
      summaryMessageEl.textContent = '';
      summaryNoteEl.textContent = '';

      if (restartBtn) {
        restartBtn.classList.add('hidden');
        restartBtn.onclick = () => setActiveType(type);
      }

      let current = 0;
      let score = 0;
      const total = quiz.cards.length;

      scoreEl.textContent = '0';
      progressEl.textContent = '1';

      const cards = quiz.cards.map((card, index) => {
        const cardEl = buildQuizCardElement(card, index, total);
        cardEl.style.zIndex = String(total - index);
        stackEl.appendChild(cardEl);
        return cardEl;
      });

      const updateProgress = () => {
        progressEl.textContent = String(Math.min(current + 1, total));
      };

      const showSummary = () => {
        summaryEl.classList.remove('hidden');
        summaryTitleEl.textContent = quiz.summary.title;
        if (score === total) {
          summaryMessageEl.textContent = quiz.summary.winMessage;
          summaryNoteEl.textContent = '올킬! 모든 라운드를 완벽하게 클리어했습니다.';
        } else if (score === 0) {
          summaryMessageEl.textContent = quiz.summary.loseMessage;
          summaryNoteEl.textContent = '다음엔 초반 전략부터 다시 세팅해보세요.';
        } else if (score >= Math.ceil(total / 2)) {
          summaryMessageEl.textContent = quiz.summary.winMessage;
          summaryNoteEl.textContent = `총 ${total}라운드 중 ${score}개 성공. 한 번 더 도전하면 완벽에 가까워요.`;
        } else {
          summaryMessageEl.textContent = quiz.summary.loseMessage;
          summaryNoteEl.textContent = `총 ${total}라운드 중 ${score}개 성공. 전략을 재정비하고 다시 도전하세요.`;
        }
        if (restartBtn) {
          restartBtn.classList.remove('hidden');
        }
      };

      const handleOption = (cardEl, optionBtn) => {
        if (cardEl.dataset.locked === 'true') {
          return;
        }
        cardEl.dataset.locked = 'true';

        const isCorrect = optionBtn.dataset.correct === 'true';
        if (isCorrect) {
          score += 1;
        }

        cardEl.querySelectorAll('.quiz-option').forEach((btn) => {
          btn.disabled = true;
          if (btn !== optionBtn) {
            btn.classList.add('quiz-option-disabled');
          }
          if (btn.dataset.correct === 'true' && !isCorrect) {
            btn.classList.add('quiz-option-correct');
          }
        });

        optionBtn.classList.add(isCorrect ? 'quiz-option-correct' : 'quiz-option-wrong');

        const badgeEl = cardEl.querySelector('[data-role="result-badge"]');
        const resultTextEl = cardEl.querySelector('[data-role="result-text"]');
        const resultFeedbackEl = cardEl.querySelector('[data-role="result-feedback"]');
        cardEl.querySelector('.quiz-card-inner').classList.add('flipped');

        badgeEl.textContent = isCorrect ? cardEl.dataset.success : cardEl.dataset.failure;
        badgeEl.classList.remove('result-success', 'result-fail');
        badgeEl.classList.add(isCorrect ? 'result-success' : 'result-fail');
        resultTextEl.textContent = optionBtn.textContent.trim();
        resultFeedbackEl.textContent = optionBtn.dataset.feedback;

        scoreEl.textContent = String(score);
      };

      const handleNext = (cardEl) => {
        if (cardEl.dataset.locked !== 'true') {
          return;
        }
        cardEl.classList.remove('active');
        cardEl.classList.add('completed');
        current += 1;

        if (current < total) {
          cards[current].classList.add('active');
          updateProgress();
        } else {
          progressEl.textContent = String(total);
          showSummary();
        }
      };

      cards.forEach((cardEl) => {
        cardEl.querySelectorAll('.quiz-option').forEach((btn) => {
          btn.addEventListener('click', () => handleOption(cardEl, btn));
        });
        const nextBtn = cardEl.querySelector('[data-next]');
        if (nextBtn) {
          nextBtn.addEventListener('click', () => handleNext(cardEl));
        }
      });

      if (cards[0]) {
        cards[0].classList.add('active');
      }

      updateProgress();
    }

    function buildQuizCardElement(card, index, total) {
      const cardEl = document.createElement('div');
      cardEl.className = 'quiz-card';
      if (index === 0) {
        cardEl.classList.add('active');
      }
      cardEl.dataset.index = String(index);
      cardEl.dataset.success = card.success;
      cardEl.dataset.failure = card.failure;

      const inner = document.createElement('div');
      inner.className = 'quiz-card-inner';

      const front = document.createElement('div');
      front.className = 'quiz-card-face quiz-card-front';

      const roundBadge = document.createElement('span');
      roundBadge.className = 'quiz-round';
      roundBadge.textContent = card.round;
      front.appendChild(roundBadge);

      const titleEl = document.createElement('h4');
      titleEl.className = 'text-2xl font-semibold text-slate-100';
      titleEl.textContent = card.title;
      front.appendChild(titleEl);

      const promptEl = document.createElement('p');
      promptEl.className = 'mt-2 text-sm text-slate-200';
      promptEl.textContent = card.prompt;
      front.appendChild(promptEl);

      if (card.hint) {
        const hintEl = document.createElement('p');
        hintEl.className = 'quiz-hint';
        hintEl.textContent = card.hint;
        front.appendChild(hintEl);
      }

      const optionsWrap = document.createElement('div');
      optionsWrap.className = 'mt-6 flex flex-col gap-3';
      shuffleArray(card.options || []).forEach((option) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'quiz-option';
        btn.dataset.correct = option.isCorrect ? 'true' : 'false';
        btn.dataset.feedback = option.feedback;
        btn.textContent = option.label;
        optionsWrap.appendChild(btn);
      });
      front.appendChild(optionsWrap);

      const back = document.createElement('div');
      back.className = 'quiz-card-face quiz-card-back';

      const badgeEl = document.createElement('div');
      badgeEl.className = 'result-badge';
      badgeEl.setAttribute('data-role', 'result-badge');
      back.appendChild(badgeEl);

      const resultTitle = document.createElement('h5');
      resultTitle.className = 'text-xl font-semibold text-slate-100';
      resultTitle.setAttribute('data-role', 'result-text');
      back.appendChild(resultTitle);

      const feedbackEl = document.createElement('p');
      feedbackEl.className = 'mt-3 text-sm text-slate-300';
      feedbackEl.setAttribute('data-role', 'result-feedback');
      back.appendChild(feedbackEl);

      const nextBtn = document.createElement('button');
      nextBtn.type = 'button';
      nextBtn.className = 'mt-6 inline-flex items-center justify-center rounded-2xl border border-white/10 bg-white/10 px-5 py-2 text-sm font-semibold text-slate-100 transition hover:bg-white/20';
      nextBtn.setAttribute('data-next', 'true');
      nextBtn.textContent = index === total - 1 ? '결과 보기' : '다음 카드';
      back.appendChild(nextBtn);

      inner.appendChild(front);
      inner.appendChild(back);
      cardEl.appendChild(inner);
      return cardEl;
    }

    function shuffleArray(arr) {
      const copy = arr.slice();
      for (let i = copy.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    const urlParams = new URLSearchParams(window.location.search);
    const requestedType = (urlParams.get("type") || "").toUpperCase();
    const initialType = MBTI_DATA[requestedType] ? requestedType : "ENFP";
    setActiveType(initialType, true);
  </script>
</body>
</html>
